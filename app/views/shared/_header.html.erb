<%= stylesheet_link_tag "header" %>

<div class="header-main">
	<div id="menu-holder">
		<div id="header-mob-menu"><%= image_tag "menu.svg", :width => "35" %></div>
		<div id="mobile-menu">
			<!-- Mobile Menu Navigation -->
			<div><a href="/">Home</a></div>
			<% if current_user %>
				<div><a href="/schedule">My Schedule</a></div>
			<% end %>
			<div><a href="/about">About</a></div>
			<div><a href="/status">Status</a></div>
			<div>
				<a href="http://carpe-dev.tumblr.com/" target="_blank">
					Blog
					<!--
					<div class="new-tab-icon"></div>
					<%= image_tag "new-tab-orange.svg", id: "new-tab-preload" %>
					-->
				</a>
			</div>
		</div>
		<span class="carpe-font" id="header-logo">
			<a href="/"><%= image_tag "toplogo.png", :class => "carpeheader" %></a>
		</span>
	</div>
	<span class="header-text">
		<!-- Desktop Menu Navigation -->
		<a href="/" class="<%= current_page?('/') ? 'active' : ''%>">Home</a>
		<% if current_user %>
			<a href="/schedule" class="<%= current_page?('/schedule') ? 'active' : ''%>">My Schedule</a>
		<% end %>
    <a href="/groups" class="<%= current_page?('/groups') ? 'active' : ''%>">Groups</a>
		<a href="/about" class="<%= current_page?('/about') ? 'active' : ''%>">About</a>
		<a href="/status" class="<%= current_page?('/status') ? 'active' : ''%>">Status</a>
		<a href="http://carpe-dev.tumblr.com/" target="_blank">
			Blog
			<div class="new-tab-icon"></div>
			<%= image_tag "new-tab-orange.svg", id: "new-tab-preload" %>
		</a>
		<% if current_user %>
			<br class="tablet-br">
			<%= form_tag("/search_users", method: "get", id: "users-search") do %>
			  <%= text_field_tag(:q, nil, placeholder: "Search people", autocomplete: "off") %>
			<% end %>
		<% end %>
	</span>
	<% if current_user %>
    <%
      follow_requests = current_user.passive_relationships.where(confirmed: nil)
      general_notifications = current_user.notifications.where(viewed: false)
      group_invites = current_user.users_groups.where(accepted: false)
      notif_count = general_notifications.size + follow_requests.size + group_invites.size
    %>

    <div id="user-name-panel" class="carpe-color">
			<div class="bell-hold">
				<% if notif_count > 0 %>
					<div id="num"><%= notif_count %></div>
				<% end %>
				<%= image_tag "bellg.svg", class: "bell" %>
			</div>
			<div id="user-avatar" class="avatar">
				<img src="<%= current_user.avatar_url(90) %>">
			</div>
			<span class="name"><%= current_user.name.split(" ")[0] %></span>
		</div>
	<% else %>
		<div id="user-name-panel" class="carpe-color">
			<span class="header-logintext">
				<%= link_to "Sign in", new_user_session_path %> or
				<%= link_to "Sign up", new_user_registration_path(:refer => "hdr") %>
			</span>
		</div>
	<% end %>
</div>

<% if current_user %>
	<div id="user-panel" class="menu">
		<%= link_to user_path(current_user) do %><div>View Profile</div><% end %>
		<%= link_to edit_user_registration_path do %><div>Edit Profile</div><% end %>
		<% if current_user.admin %>
			<%= link_to admin_panel_url do %><div>Admin Panel</div><% end %>
		<% end %>
		<%= link_to destroy_user_session_path, :method => :delete do %><div>Sign out</div><% end %>
	</div>

	<div id="notif-panel" class="menu">
		<% unless follow_requests.empty? %>
			<div id="notif-title">Follow Requests</div>
			<% follow_requests.each do |n| %>

        <div class="notif" fid="<%= n.id %>">
          <%= link_avatar n.follower, size: 40 %>
					<span><%= n.follower.name %></span>
					<%= link_to relationship_path(n, "relationship[confirmed]": true), :method => :put, :remote => true do %>
						<div class="confirm"></div>
					<% end %>
					<%= link_to relationship_path(n, "relationship[confirmed]": false), :method => :put, :remote => true do %>
						<div class="deny"></div>
					<% end %>
				</div>

			<% end %>
		<% end %>
		<div id="no-notifs" style="<%= 'display: none' if notif_count > 0 %>">You don't have any notifications right now.</div>

  <% unless group_invites.empty? %>
    <div id="notif-title">Group Invites</div>
    <% group_invites.each do |n| %>

      <div class="notif" fid="<%= n.id %>">
        <%= link_avatar n.group, size: 40 %>
        <span><%= n.group.name %></span>
        <%= link_to user_group_path(n, confirm: "true"), method: :put, remote: true do %>
          <div class="confirm"></div>
        <% end %>
        <%= link_to user_group_path(n, confirm: "false"), method: :put, remote: true do %>
          <div class="deny"></div>
        <% end %>
      </div>

    <% end %>
  <% end %>
	</div>

  <% general_notifications.each do |n| %>
    <div class="notif general">
      <%= link_avatar n.sender, size: 40 %>
      <div><%= "#{n.sender.name n.message}" %></div>
    </div>
  <% end %>
  </div>
<% end %>