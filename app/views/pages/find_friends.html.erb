<% content_for :title do %> - Find Friends<% end %>

<style>
/* Find Friends page stuff */
.user-box
{
    width: 132px;
    margin-bottom: 10px;
    float: left;
    padding: 10px 5px 5px 5px;
    min-height: 210px;
    background: #F5F5F5;
    margin: 5px;
    border-radius: 5px;
    box-shadow: 1px 1px 1px silver;
}
.user-box .name
{
	font-size: 16px;
	margin-bottom: 7px;
}
</style>
<div class="page-container">
	<h1 class="page-titler">Find your friends.</h1>
	<h3 class="page-desc">
		We've listed some people you may know to start. If you can't find someone, you can search for them below.
		<%= form_tag("/search_users", method: "get") do %>
		  <%= text_field_tag(:q, params[:q]) %>
		  <%= submit_tag("Search") %>
		<% end %>
	</h3>
	<% if @users != nil %>
		<% users = @users %> 
		<h3>Showing results for "<%= params[:q] %>"</h3>
	<% else 
		users = User.all
	end %>
	
	<% if users.size > 0 %>
	<% users = users.sort_by{|u| -current_user.mutual_friends(u).count }%>
	<% users.each do |user| %>
		<% status = current_user.friend_status(user) %>
		<% if current_user != user and status != "friend"  %>
			<div class="user-box">
				<div class="avatar">
					<a href="/u/<%= user.id %>"><img src="<%= user.user_avatar(100) %>"></a>
				</div>
				<div class="name">
					<%= user.name %><br>
					<% mut = current_user.mutual_friends(user).count %>
					<%= mut %> mutual
				</div>
				<% if status == nil #not friends %>
					<%= link_to friendships_path(:friend_id => user), :method => :post, :class => "default green" do %>
						<span>Add Friend</span>
					<% end %>
				<% elsif status == "friend" %>
					<span class="friend-label">Friend</span>
				<% elsif status == "pending" || status == "denied" %>
					<span class="friend-label">Pending...</span>
				<% end %>
			</div>
		<% end %>
	<% end %>
	<% else %>
		No users found with that name!
	<% end %>
</div>
